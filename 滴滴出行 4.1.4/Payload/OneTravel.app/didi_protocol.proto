// $Id: didi_protocol.proto 2262 2015-04-02 12:35:40Z yiyuanzhong $

option java_package = "com.sdu.didi.protobuf";
option java_outer_classname = "DiDiCommonProtobuf";

package DidiPush;
//update time: 2014-4-23 15:43 (新增kPushStrategyTryBest)
//update time: 2014-4-8 17:00 (新增DispatchSvr,MsgType value redefined)
//update time: 2014-4-3 19:48 (新增CollectSvr)
//update time: 2014-4-3 11:00 (新增PushSvr)
//update time: 2014-4-2 13:06 (CdntSvr支持多对多关系)
// full package = outer_header + header + payload
// outer_header = magic(2B)+payload_offset(2B,payload offset)+data_length(4B,full package length)
//   .magic = kMagic
//   .payload_offset = sizeof(outer_header) + sizeof(header)
//   .data_length  = sizeof(full package)
// header       = (outer_header.payload_offset - sizeof(outer_header)) bytes，see protobuf message Header
// payload      = (data_length - outer_header.payload_offset) bytes, decided by Header.type
// 协议中出现的所有user_id(eg.
// driver_id,auth_user_id,user_id)均为uint64_t，最高16位为角色标记(0: 司机,1: 乘客)，其余48位为相应角色下的唯一标识(自增id)

enum Constants {
    // On wire format: 0x54 0x58
	//different from asn(ASN1.3(1B):'0' ,ASN20(4B): 0x4E534153)
    kMagic = 0x5854 ;
    kNodeTypeMask = 0xF;
	//0x?00
    kNodeTypeShiftBits = 8 ;
}

enum NodeType {
	// unknown
    kNodeTypeMin            = 0x0 ;
	// APP
    kNodeTypeApp            = 0x1 ;
	// 长连接server
    kNodeTypeConnSvr        = 0x2 ;
	// 长连接master
    kNodeTypeConnMasterSvr  = 0x3 ;
	// 坐标转发服务
    kNodeTypeCdntSvr        = 0x4 ;
	// 认证服务
    kNodeTypeAuthSvr        = 0x5 ;
	// Push服务(推送消息给APP)
    kNodeTypePushSvr        = 0x6 ;
	// 数据收集server
    kNodeTypeCollectSvr     = 0x7 ;
	// dispatch
    kNodeTypeDispatchSvr    = 0x8 ;
	// IM - Message
    kNodeTypeMessageSvr     = 0x9 ;
	// IM - Session
    kNodeTypeSessionSvr     = 0xA ;
	// IM - File
    kNodeTypeFileSvr        = 0xB ;
	// Repush服务(retry PushSvr) - Inner Use
    kNodeTypeRepushSvr      = 0xC ;
	// DbSvr mysql 同步转异步
    kNodeTypeDbSvr          = 0xD ;
	// 结束
    kNodeTypeMax            = 0xF ;
};


//type(暂时只用了4b + 1B) = type_reserved(20b) + node_type(4b) + real_msg_type(7b)+request_or_response(1b)
// request_or_response, 1: request ,0: response(即奇数为请求，偶数为响应)
enum MsgType {
	// unknow
    kMsgTypeMin                      = 0x000 ;

    // APP(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeAppTypeMin               = 0x100 ;
	// ConnSvr -> APP: 连接挑战 (real kMsgTypeAppConnectChallenge)
    kMsgTypeConnSvrConnectChallenge  = 0x101 ;
	// ConnSvr -> APP: 心跳请求
    kMsgTypeAppHeartbeatReq          = 0x103 ;
	// APP -> ConnSvr: 心跳响应
    kMsgTypeAppHeartbeatRsp          = 0x104 ;
	// CdntSvr -> ConnSvr -> APP: 下载坐标请求
    kMsgTypeCdntSvrDownReq           = 0x105 ;
	// APP -> ConnSvr -> CdntSvr(暂不需要): 下载坐标响应
    kMsgTypeCdntSvrDownRsp           = 0x106 ;
	// PushSvr -> ConnSvr -> APP 请求: 下推消息给APP
    kMsgTypeAppPushMessageReq        = 0x107 ;
	// APP -> ConnSvr -> PushSvr 响应
    kMsgTypeAppPushMessageRsp        = 0x108 ;
	// ConnSvr -> APP: 立刻发起心跳(时间同步)
    kMsgTypeAppSynchronizeReq        = 0x109 ;
	// 结束
    kMsgTypeAppTypeMax               = 0x1FF ;

    // ConnSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeConnSvrTypeMin           = 0x200 ;
	// APP -> ConnSvr: 连接建立请求
    kMsgTypeConnSvrConnectReq        = 0x201 ;
	// ConnSvr -> APP: 连接建立响应
    kMsgTypeConnSvrConnectRsp        = 0x202 ;
	// ConnSvr -> APP: 连接断开请求
    kMsgTypeConnSvrDisconnectReq     = 0x203 ;
	// APP -> ConnSvr(暂不需要): 链接断开响应
    kMsgTypeConnSvrDisconnectRsp     = 0x204 ;
	// ConnMaster -> ConnSvr: 获取所有连接信息请求
    kMsgTypeConnSvrGetOnlineReq      = 0x205 ;
	// ConnSvr -> ConnMaster: 获取所有连接信息响应
    kMsgTypeConnSvrGetOnlineRsp      = 0x206 ;
	// ConnMaster -> ConnSvr: 获取连接总数请求
    kMsgTypeConnSvrGetOnlineCountReq = 0x207 ;
	// ConnSvr -> ConnMaster: 获取连接总数响应
    kMsgTypeConnSvrGetOnlineCountRsp = 0x208 ;
	// APP -> ConnSvr: 心跳请求
    kMsgTypeConnSvrHeartbeatReq      = 0x209 ;
	// ConnSvr -> APP: 心跳响应
    kMsgTypeConnSvrHeartbeatRsp      = 0x20A ;
	// ConnMaster -> ConnSvr: 获取是否在线请求
    kMsgTypeConnSvrGetIfOnlineReq    = 0x20B ;
	// ConnSvr -> ConnMaster: 获取是否在线响应
    kMsgTypeConnSvrGetIfOnlineRsp    = 0x20C ;
	// ConnMaster - > ConnSvr: 踢连接
    kMsgTypeConnSvrKickNoRspReq      = 0x20D ;
	// 结束
    kMsgTypeConnSvrTypeMax           = 0x2FF ;

    // ConnMaster(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeConnMasterTypeMin           = 0x300 ;
	// * -> ConnMaster: 获取路由请求
    kMsgTypeConnMasterGetRouteReq       = 0x301 ;
	// ConnMaster -> *: 获取路由响应
    kMsgTypeConnMasterGetRouteRsp       = 0x302 ;
	// * -> ConnMaster: 设置路由请求
    kMsgTypeConnMasterSetRouteReq       = 0x303 ;
	// ConnMaster -> *: 设置路由响应
    kMsgTypeConnMasterSetRouteRsp       = 0x304 ;
	// * -> ConnMaster: 删除路由请求
    kMsgTypeConnMasterDelRouteReq       = 0x305 ;
	// ConnMaster -> *: 删除路由响应
    kMsgTypeConnMasterDelRouteRsp       = 0x306 ;
	// * -> ConnMaster: 获取所有连接信息请求
    kMsgTypeConnMasterGetOnlineReq      = 0x307 ;
	// ConnMaster -> *: 获取所有连接信息响应
    kMsgTypeConnMasterGetOnlineRsp      = 0x308 ;
	// * -> ConnMaster: 获取连接总数请求
    kMsgTypeConnMasterGetOnlineCountReq = 0x309 ;
	// ConnMaster -> *: 获取连接总数响应
    kMsgTypeConnMasterGetOnlineCountRsp = 0x30A ;
	// * -> ConnMaster: 获取是否在线请求
    kMsgTypeConnMasterGetIfOnlineReq    = 0x30B ;
	// ConnMaster -> *: 获取是否在线响应
    kMsgTypeConnMasterGetIfOnlineRsp    = 0x30C ;
	// * -> ConnMaster: 广播踢连接请求
    kMsgTypeConnMasterKickReq           = 0x30D ;
	// ConnMaster -> *: 广播踢连接响应
    kMsgTypeConnMasterKickRsp           = 0x30E ;
	// 结束
    kMsgTypeConnMasterTypeMax           = 0x3FF ;

    // CdntSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeCdntSvrTypeMin           = 0x400 ;
	// APP -> ConnSvr -> CdntSvr: 上传坐标请求
    kMsgTypeCdntSvrUpReq             = 0x401 ;
	// CdntSvr -> ConnSvr -> APP(暂不需要): 上传坐标响应
    kMsgTypeCdntSvrUpRsp             = 0x402 ;
	// PHP -> CdntSvr: 设置司机乘客关联关系请求
    kMsgTypeCdntSvrSetRelationReq    = 0x403 ;
	// CdntSvr -> PHP: 设置司机乘客关联关系响应
    kMsgTypeCdntSvrSetRelationRsp    = 0x404 ;
	// PHP -> CdntSvr: 删除司机乘客关联关系请求
    kMsgTypeCdntSvrDelRelationReq    = 0x405 ;
	// CdntSvr -> PHP: 删除司机乘客关联关系响应
    kMsgTypeCdntSvrDelRelationRsp    = 0x406 ;
	// PHP -> CdntSvr: 获取司机乘客关联关系请求
    kMsgTypeCdntSvrGetRelationReq    = 0x407 ;
	// CdntSvr -> PHP: 获取司机乘客关联关系响应
    kMsgTypeCdntSvrGetRelationRsp    = 0x408 ;
	// PHP -> CdntSvr: 添加司机乘客关联关系请求
    kMsgTypeCdntSvrAddRelationReq    = 0x409 ;
	// CdntSvr -> PHP: 添加司机乘客关联关系响应
    kMsgTypeCdntSvrAddRelationRsp    = 0x40A ;
	// 结束
    kMsgTypeCdntSvrTypeMax           = 0x4FF ;

    // AuthSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeAuthSvrTypeMin           = 0x500 ;
	// * -> AuthSvr: 设置用户登录token请求
    kMsgTypeAuthSvrAddUserReq        = 0x501 ;
	// AuthSvr -> *: 设置用户登录token响应
    kMsgTypeAuthSvrAddUserRsp        = 0x502 ;
	// * -> AuthSvr: 删除用户登录token请求
    kMsgTypeAuthSvrDelUserReq        = 0x503 ;
	// AuthSvr -> *: 删除用户登录token响应
    kMsgTypeAuthSvrDelUserRsp        = 0x504 ;
	// ConnSvr -> AuthSvr: 登录用户
    kMsgTypeAuthSvrLoginReq          = 0x505 ;
	// AuthSvr -> ConnSvr: 登录用户
    kMsgTypeAuthSvrLoginRsp          = 0x506 ;
	// * -> AuthSvr: 电话号码查询UserId request
    kMsgTypeAuthSvrQueryUserReq      = 0x507 ;
	// AuthSvr -> *: 电话号码查询UserId response
    kMsgTypeAuthSvrQueryUserRsp      = 0x508 ;
	// * -> AuthSvr: 请求签名
    kMsgTypeAuthSvrSignReq           = 0x509 ;
	// AuthSvr -> *: 返回签名
    kMsgTypeAuthSvrSignRsp           = 0x50A ;
	// 结束
    kMsgTypeAuthSvrTypeMax           = 0x5FF ;

    // PushSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypePushSvrTypeMin           = 0x600 ;
	// * -> PushSvr[ -> APP 请求]
    kMsgTypePushSvrReq               = 0x601 ;
	// [APP->]PushSvr -> * 响应
    kMsgTypePushSvrRsp               = 0x602 ;
	// * -> PushSvr[ -> APP 批量请求]
    kMsgTypePushSvrMultiReq          = 0x603 ;
	// [APP->]PushSvr -> * 批量响应
    kMsgTypePushSvrMultiRsp          = 0x604 ;
	// APP -> ConnSvr -> PushSvr: 上报收到消息
    kMsgTypePushSvrAppRspReq         = 0x605 ;
	// RepushSvr -> PushSvr 请求: RepushSvr专用
    kMsgTypePushSvrRetryReq          = 0x607 ;
	// PushSvr -> RepushSvr 响应: RepushSvr专用
    kMsgTypePushSvrRetryRsp          = 0x608 ;
	// * -> PushStat
    kMsgTypePushStatReq              = 0x609 ;
	// PushStat -> *
    kMsgTypePushStatRsp              = 0x610 ;
	// 结束
    kMsgTypePushSvrTypeMax           = 0x6FF ;

    // CollectSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeCollectSvrTypeMin        = 0x700 ;
	// APP -> ConnSvr -> CollectSvr -> Proxy 无响应的请求
    kMsgTypeCollectSvrNoRspReq       = 0x701 ;
	// CollectSvr -> Proxy 心跳
    kMsgTypeCollectSvrHeartbeatReq   = 0x703 ;
	// Proxy -> CollectSvr 心跳回报
    kMsgTypeCollectSvrHeartbeatRsp   = 0x704 ;
	// 结束
    kMsgTypeCollectSvrTypeMax        = 0x7FF ;

    // DispatchSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeDispatchSvrTypeMin       = 0x800 ;
	// APP -> ConnSvr or ConnMaster -> DispatchSvr -> PHP无响应的请求
    kMsgTypeDispatchSvrNoRspReq      = 0x801 ;
	// APP -> APP -> ConnSvr -> DispatchSvr
    kMsgTypeDispatchSvrReq           = 0x803 ;
	// APP -> DispatchSvr -> ConnSvr -> APP
    kMsgTypeDispatchSvrRsp           = 0x804 ;
	// 结束
    kMsgTypeDispatchSvrTypeMax       = 0x8FF ;

    // MessageSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeMessageSvrTypeMin        = 0x900 ;
	// APP -> ConnSvr -> MessageSvr: 查询会话列表
    kMsgTypeMessageSvrGetSessionsReq = 0x901 ;
	// MessageSvr -> ConnSvr -> APP: 查询会话列表
    kMsgTypeMessageSvrGetSessionsRsp = 0x902 ;
	// APP -> ConnSvr -> MessageSvr: 下载消息
    kMsgTypeMessageSvrGetMessagesReq = 0x903 ;
	// MessageSvr -> ConnSvr -> APP: 下载消息
    kMsgTypeMessageSvrGetMessagesRsp = 0x904 ;
	// APP -> ConnSvr -> MessageSvr: 发送文本
    kMsgTypeMessageSvrSendTextReq    = 0x905 ;
	// MessageSvr -> ConnSvr -> APP: 发送文本
    kMsgTypeMessageSvrSendTextRsp    = 0x906 ;
	// APP -> ConnSvr -> MessageSvr: 准备富媒体
    kMsgTypeMessageSvrNewObjectReq   = 0x907 ;
	// MessageSvr -> ConnSvr -> APP: 准备富媒体
    kMsgTypeMessageSvrNewObjectRsp   = 0x908 ;
	// APP -> ConnSvr -> MessageSvr: 发送富媒体
    kMsgTypeMessageSvrSendObjectReq  = 0x909 ;
	// MessageSvr -> ConnSvr -> APP: 发送富媒体
    kMsgTypeMessageSvrSendObjectRsp  = 0x90A ;
	// * -> PushSvr -> ConnSvr-> APP: 通知
    kMsgTypeMessageSvrNotification   = 0x90B ;
	// 结束
    kMsgTypeMessageSvrTypeMax        = 0x9FF ;

    // SessionSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeSessionSvrTypeMin        = 0xA00 ;
	// PHP -> SessionSvr: 创建会话
    kMsgTypeSessionSvrCreateReq      = 0xA01 ;
	// SessionSvr -> PHP: 创建会话
    kMsgTypeSessionSvrCreateRsp      = 0xA02 ;
	// PHP -> SessionSvr: 冻结会话
    kMsgTypeSessionSvrFreezeReq      = 0xA03 ;
	// SessionSvr -> PHP: 冻结会话
    kMsgTypeSessionSvrFreezeRsp      = 0xA04 ;
	// MessageSvr -> SessionSvr: 查询sid
    kMsgTypeSessionSvrGetSessionsReq = 0xA05 ;
	// SessionSvr -> MessageSvr: 查询sid
    kMsgTypeSessionSvrGetSessionsRsp = 0xA06 ;
	// MessageSvr -> SessionSvr: 申请mid
    kMsgTypeSessionSvrNewMessageReq  = 0xA07 ;
	// SessionSvr -> MessageSvr: 申请mid
    kMsgTypeSessionSvrNewMessageRsp  = 0xA08 ;
	// MessageSvr -> SessionSvr: 是否可以下载
    kMsgTypeSessionSvrGetMessageReq  = 0xA09 ;
	// SessionSvr -> MessageSvr: 是否可以下载
    kMsgTypeSessionSvrGetMessageRsp  = 0xA0A ;
	// MessageSvr -> SessionSvr: 准备富媒体
    kMsgTypeSessionSvrNewObjectReq   = 0xA0B ;
	// SessionSvr -> MessageSvr: 准备富媒体
    kMsgTypeSessionSvrNewObjectRsp   = 0xA0C ;
	// MessageSvr -> SessionSvr: 发送富媒体
    kMsgTypeSessionSvrSendObjectReq  = 0xA0D ;
	// SessionSvr -> MessageSvr: 发送富媒体
    kMsgTypeSessionSvrSendObjectRsp  = 0xA0E ;
	// FileSvr -> SessionSvr: 是否可以上传
    kMsgTypeSessionSvrCheckObjectReq = 0xA0F ;
	// SessionSvr -> FileSvr: 是否可以上传
    kMsgTypeSessionSvrCheckObjectRsp = 0xA10 ;
	// 结束
    kMsgTypeSessionSvrTypeMax        = 0xAFF ;

    // FileSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeFileSvrTypeMin           = 0xB00 ;
	// APP -> FileSvr: 上传富媒体
    kMsgTypeFileSvrUploadReq         = 0xB01 ;
	// FileSvr -> APP: 上传富媒体
    kMsgTypeFileSvrUploadRsp         = 0xB02 ;
	// APP -> FileSvr: 下载富媒体
    kMsgTypeFileSvrDownloadReq       = 0xB03 ;
	// FileSvr -> APP: 下载富媒体
    kMsgTypeFileSvrDownloadRsp       = 0xB04 ;
	// 结束
    kMsgTypeFileSvrTypeMax           = 0xBFF ;

    // RepushSvr(request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeRepushSvrTypeMin         = 0xC00 ;
	// PushSvr -> RepushSvr: 暂存消息
    kMsgTypeRepushSvrStageMsgReq     = 0xC01 ;
	// RepushSvr -> PushSvr: 暂存消息
    kMsgTypeRepushSvrStageMsgRsp     = 0xC02 ;
	// 结束
    kMsgTypeRepushSvrTypeMax         = 0xCFF ;

    // DbSvr (request & response,请求用奇数,响应用偶数)
	// 开始
    kMsgTypeDbSvrTypeMin             = 0xD00 ;
	// Sql cmd which return records set
    kMsgTypeDbSvrSqlQueryReq         = 0xD01 ;
	// SqlQuery Response: query set
    kMsgTypeDbSvrSqlQueryRsp         = 0xD02 ;
	// Sql cmd which return simple result
    kMsgTypeDbSvrSqlExecReq          = 0xD03 ;
	// SqlExec Response: simple result
    kMsgTypeDbSvrSqlExecRsp          = 0xD04 ;
	// switch db request
    kMsgTypeDbSvrSelectDbReq         = 0xD05 ;
	// switch db response
    kMsgTypeDbSvrSelectDbRsp         = 0xD06 ;
	// invalid request rsp
    kMsgTypeDbSvrInvalidReqRsp       = 0xD08 ;
	// 结束
    kMsgTypeDbSvrTypeMax             = 0xDFF ;
}

// WARNING WARNING WARNING
// WARNING WARNING WARNING
// WARNING WARNING WARNING
// ！！禁止新代码使用这个东西，禁止修改这个东西！！
//注意:本枚举类型和高16bit的定义不一致
enum OldRole {
    OldUnknown = 0;
    OldDriver = 1;
    OldPassenger = 2;
    OldPilot = 3;
}
// ！！禁止新代码使用这个东西，禁止修改这个东西！！
// WARNING WARNING WARNING
// WARNING WARNING WARNING
// WARNING WARNING WARNING

enum Role {
    Driver = 0;
    Passenger = 1;
    Pilot = 2;
    ESPassenger = 3;
    WaliDriver = 5;
}

enum Product {
	// 不区分
    ProductNone     = 0x000 ;
	// 出租车
    ProductTaxi     = 0x101 ;
	// 专车
    ProductPrivate  = 0x102 ;
	// 顺风车
    ProductCarPool  = 0x103 ;
	// 快车
    ProductFast     = 0x104 ;
	// 瓦力
    ProdcutWali     = 0x105 ;
    // 企业乘客
    ProductESP      = 0x106 ;
    // Nova汽车
    ProductNova      = 0x10c ;
}


//头部
message UserAgent {
	// 操作系统类型
    optional string os_type     = 1 ;
	// 操作系统版本
    optional string os_ver      = 2 ;
	// 设备型号
    optional string model       = 3 ;
	// 客户端版本
    optional string client_ver  = 4 ;
	// ISP信息
    optional string network     = 5 ;
	// 当前位置
    optional string location    = 6 ;
	// 运营商
    optional string carrier_operator    = 7 ;
}

message Header {
	//payload type, enum MsgType
    required int32      type = 1 ;
	// rsp copied from req
    optional uint64     msg_id = 2 ;
	//
    optional uint64     auth_user_id = 3 ;
    optional bytes      log_id = 4;
	// Only present in intranet packets.
    optional UserAgent  user_agent = 5 ;
    optional uint64     timestamp = 6;
}

//rsp_code可能值
enum RspCode {
    kRspCodeConnSvrMin                   = 1;
    kRspCodeConnSvrTimedOut              = 2;
    kRspCodeConnSvrInternalError         = 3;
    kRspCodeConnSvrMax                   = 99;

    kRspCodeCdntSvrMin                   = 201;
    kRspCodeCdntSvrNotExist              = 202;
    kRspCodeCdntSvrAccessCkvError        = 203;
	//输入参数错误
    kRspCodeCdntSvrArgsError             = 204 ;
    kRspCodeCdntSvrMax                   = 299;

    kRspCodeConnMasterMin                = 401;
    kRspCodeConnMasterKeyNotExist        = 402;
    kRspCodeConnMasterTimedOut           = 403;
    kRspCodeConnMasterAccessCkvTimedOut  = 404;
    kRspCodeConnMasterPbDecodeError      = 405;
    kRspCodeConnMasterCkvDecodeFailed    = 406;
    kRspCodeConnMasterCkvCasNewer        = 407;
	// when add ckv
    kRspCodeConnMasterKeyExistWhenAdd    = 408 ;
	// GetIfOnline user_id size out of range
    kRspCodeConnMasterIfOnlineOutRange   = 409 ;
    kRspCodeConnMasterMax                = 499;

    kRspCodeAuthSvrMin                   = 601;
    kRspCodeAuthSvrKeyNotExist           = 602;
    kRspCodeAuthSvrParamError            = 603;
    kRspCodeAuthSvrDelTokenError         = 604;
    kRspCodeAuthSvrAddTokenError         = 605;
    kRspCodeAuthSvrLoginError            = 606;
    kRspCodeAuthSvrGetUserIdError        = 607;
    kRspCodeAuthSvrDecodeError           = 608;
    kRspCodeAuthSvrHmacEncodeError       = 609;
    kRspCodeAuthSvrBase64EncodeError     = 610;
    kRspCodeAuthSvrMax                   = 699;

    kRspCodePushSvrMin                   = 0x600;
    kRspCodePushSvrInternalError         = 0x601;
	// 消息已暂存,稍候会自动尝试重发
    kRspCodePushSvrMsgStaged             = 0x602 ;
	// 请求端参数错误
    kRspCodePushSvrInvalidArgs           = 0x603 ;
    kRspCodePushSvrKeyNotExist           = 0x604;
	// 用户不在线，消息已短信发送
    kRspCodePushSvrSmsMsgSend            = 0x605 ;
    kRspCodePushSvrMax                   = 0x6FF;

    kRspCodeMessageSvrMin                = 0x900;
    kRspCodeMessageSvrTimeOut            = 0x901;
    kRspCodeMessageSvrInvalidArgs        = 0x902;
	//ckv操作相关错误
    kRspCodeMessageSvrCkvError           = 0x903 ;
	//获取server操作指针出错
    kRspCodeMessageSvrGetServerError     = 0x904 ;
	//推送给pushserver失败
    kRspCodeMessageSvrToPushError        = 0x905 ;
	//推送给sessionserver失败
    kRspCodeMessageSvrToSessionError     = 0x906 ;
	//SessionServer返回参数不正确
    kRspCodeMessageSvrSessionInvalidArgs = 0x907 ;
	//数据包解包出错
    kRspCodeMessageSvrDecodeError        = 0x908 ;
    kRspCodeMessageSvrMax                = 0x9FF;

    kRspCodeSessionSvrMin                = 0xA00;
	// 内部错误，重试
    kRspCodeSessionSvrTryAgain           = 0xA01 ;
	// 非法输入
    kRspCodeSessionSvrInvalidArguments   = 0xA02 ;
	// 查无此会话
    kRspCodeSessionSvrNoSuchSession      = 0xA03 ;
	// 会话已冻结
    kRspCodeSessionSvrFrozen             = 0xA04 ;
	// 用户不属于此会话
    kRspCodeSessionSvrForbidden          = 0xA05 ;
	// 会话已消亡
    kRspCodeSessionSvrVanished           = 0xA06 ;
    kRspCodeSessionSvrMax                = 0xAFF;

    kRspCodeFileSvrMin                   = 0xB00;
	//整个任务超时
    kRspCodeFileSvrTimedOut              = 0xB01 ;
	//任务逻辑的当前状态不符合预期
    kRspCodeFileSvrStateError            = 0xB02 ;
	//没有找到可用的SessionSvr
    kRspCodeFileSvrNoSessionServer       = 0xB03 ;
	//向SessionSvr发送验证包的过程中失败
    kRspCodeFileSvrVerificationError     = 0xB04 ;
	// 没有找到可用的CkvSvr
    kRspCodeFileSvrNoCkvServer           = 0xB05 ;
	//向Ckv发送Set包的过程中失败
    kRspCodeFileSvrCkvSetError           = 0xB06 ;
	// 没有找到该key的value
    kRspCodeFileSvrKeyNotExist           = 0xB07 ;
	//SessionSvr验证返回成功，但是没有返回token
    kRspCodeFileSvrSessionNotReturnToken = 0xB08 ;
	//该Key已经插入CKV，业务要求不能插入两次及两次以上，即不能覆盖
    kRspCodeFileSvrKeyHasExist           = 0xB09 ;
	// Ckv Decode失败
    kRspCodeFileSvrCkvDecodeFailed       = 0xB0A ;
    kRspCodeFileSvrMax                   = 0xBFF;

    kRspCodeRepushSvrMin                 = 0xC00;
	// 请求端参数错误
    kRspCodeRepushSvrInvalidArgs         = 0xC01 ;
    kRspCodeRepushSvrKeyNotExist         = 0xC02;
    kRspCodeRepushSvrMax                 = 0xCFF;
}

//payload
//响应信息
message RspMsg {
	// 错误码, 0表示成功
    required int32 rsp_code = 1 ;
	// 错误描述
    optional string rsp_msg = 2 ;
}

message BinaryMsg {
	// payload类型
    required uint32 type = 1 ;
	// req payload
    optional bytes payload = 2 ;
}

message PushMsg {
	// payload类型
    required uint32 type = 1 ;
	// req payload
    optional bytes payload = 2 ;

    // bit0-7: bizType
    // bit8-15: 在相同1ms内递增的编号
    // bit16-23: 服务编号
    // bit24-63: 毫秒级timestamp
	// identify a group of push msg
    optional uint64 task_id = 3 ;
	// identify a single push msg
    optional bytes msg_id = 4 ;
	// whether app response to server
    optional bool need_rsp = 5 ;
	// @sa enum Product
    optional uint32 product = 6 ;
	// push source
    optional uint64 activity_id = 7 ;
}

//=====================ConnSvr=============================
//ConnSvr模块协议
message ConnSvrConnectReq {
	//电话号码
    required string phone_num = 1 ;
	//deprecated
    optional OldRole old_role = 2 ;
	//加密字符串
    required bytes secret_chap = 3 ;
	//Serialized and encrypted UserAgent.
    optional bytes user_agent = 4 ;
	//角色，司机还是乘客
    optional int32 role = 5 ;
}
message ConnSvrConnectRsp {
    required RspMsg rsp_msg = 1;
}
message ConnSvrDisconnectReq {} //空包，0字节的payload
//message ConnSvrDisconnectRsp = RspMsg //包和RspMsg一样
message ConnSvrHeartbeatReq {}  //空包，0字节的payload
//message ConnSvrHeartbeatRsp = RspMsg //包和RspMsg一样
message ConnSvrGetOnlineReq {} //空包，0字节的payload
message AppSynchronizeReq {}  //空包，0字节的payload

message ConnSvrGetOnlineRsp {
    required RspMsg rsp_msg = 1;
	//连接信息
    repeated uint64 user_id = 2 ;
}

message ConnSvrGetOnlineCountReq {} //空包，0字节的payload
message ConnSvrGetOnlineCountRsp {
    required RspMsg rsp_msg = 1;
	//连接数量
    required uint64 count = 2 ;
}

message ConnSvrGetIfOnlineReq {
    repeated uint64 user_id = 1;
}

message ConnSvrGetIfOnlineRsp {
    repeated uint64 user_id = 1;
}

message ConnSvrKickNoRspReq { //user_id in header
	// 时间戳标识连接, timestamp如果没填就是广播踢，如果填了就是定点踢
    optional uint64 timestamp = 1 ;
}

//=====================ConnMaster=============================
//ConnMaster模块协议
message Address {
	//server ip
    required string ip = 1 ;
	//server port
    required uint32 port = 2 ;
	// 时间戳标识连接
    optional uint64 timestamp = 3 [ default = 0] ;
	//需要统计到用户上线流水里
    optional bool should_stat = 4 [default = false] ;
}
message ConnMasterKickReq {
    required uint64 user_id = 1;
}
message ConnMasterKickRsp { //用于表示ConnMaster收到该ConnMasterKickReq
    required int32 rc = 1;
}
message ConnMasterGetIfOnlineReq {
    repeated uint64 user_id = 1;
}

message ConnMasterGetIfOnlineRsp {
    required RspMsg rsp_msg = 1;
    repeated uint64 user_id = 2;
}

message ConnMasterGetRouteReq {
	//用户id，司机和乘客都唯一的id
    required uint64 user_id = 1 ;
}
message ConnMasterGetRouteRsp {
    required RspMsg rsp_msg = 1;
	//connect server 的ip和port, rsm_msg.rsp_code == 0 时才有该字段
    optional Address conn_svr = 2 ;
}
//message ConnMasterSetRouteReq = Address //包和Address一样
//message ConnMasterSetRouteRsp = RspMsg //包和RspMsg一样
message ConnMasterDelRouteReq {
    required uint64 user_id = 1;
	// 时间戳标识连接
    optional uint64 timestamp = 2 [ default = 0] ;
}
//message ConnMasterDelRouteRsp = RspMsg
message ConnMasterGetOnlineReq{} //空包，0字节的payload
message ConnMasterGetOnlineRsp{
    required RspMsg rsp_msg = 1;
	//连接信息
    repeated uint64 user_id = 2 ;
}
message ConnMasterGetOnlineCountReq {}
message ConnMasterGetOnlineCountRsp {
    required RspMsg rsp_msg = 1;
    required uint64 count = 2;
}

//=====================AuthSvr=============================
//AuthSvr模块协议
message AuthSvrAddUserReq {
	// 用户id，司机和乘客都唯一的id
    required uint64 user_id = 1 ;
	// 用户的服务器端秘密token
    required bytes token = 2 ;
	// 电话号码
    required string phone_num = 3 ;
}
//message AuthSvrAddUserRsp = RspMsg

message AuthSvrDelUserReq {
	// 用户id，司机和乘客都唯一的id
    required uint64 user_id = 1 ;
}
//message AuthSvrDelUserRsp = RspMsg

message AuthSvrLoginReq {
	// 电话号码
    required string phone_num = 1 ;
	//deprecated
    //optional OldRole old_role = 2 ;
	// 加密字符串
    required bytes secret_chap = 3 ;
	// 随机消息 (A-Za-z0-9组成的256个字节)
    required bytes random_msg = 4 ;
    required int32 role = 5;
}

message AuthSvrLoginRsp {
    required RspMsg rsp_msg = 1;
    required uint64 user_id = 2;
}

message AuthSvrQueryUserReq {
	// 电话号码
    required string phone_num = 1 ;
	//deprecated
    //optional OldRole old_role = 2 ;
    required int32 role = 3;
}

message AuthSvrQueryUserRsp {
    required RspMsg rsp_msg = 1;
	// rsp_msg.rsp_code == 0 时返回该字段
    optional uint64 user_id = 2 ;
}

message AuthSvrSignReq {
	// 需要签名的内容
    required bytes content = 1 ;
}

message AuthSvrSignRsp {
    required RspMsg rsp_msg = 1;
	// 签名hmac的base64编码值
    optional string hmac    = 2 ;
}



//=====================CdntSvr=============================
//CdntSvr模块协议
//坐标系
enum CoordinateType {
	//百度坐标系,BD-09
    BD_09 = 1 ;
	//SOSO坐标系,GCJ-02
    GCJ_02 = 2 ;
	//国际标准坐标系,WGS-84
    WGS_84 = 4 ;
}

//坐标
message Coordinate {
    required double x = 1;
    required double y = 2;
	//坐标系
    required CoordinateType type = 3 ;
	// 坐标产生时间,seconds since epoch(app可选上报，仅用于log分析)
    optional uint32 timestamp = 4 ;
    optional double dx = 5;
    optional double dy = 6;
	// 新增字段
    optional int32 angle = 7 ;
}

message CdntSvrUpReq {
    required double x = 1;
    required double y = 2;
	//坐标系
    required CoordinateType type = 3 ;
	// 坐标产生时间,seconds since epoch(app可选上报，仅用于log分析)
    optional uint32 timestamp = 4 ;

    // 是否需要拉取对端的坐标, 没有设置该字段表示需要拉取(兼容之前的情况),
    // 设置了该字段且为false时仅存储坐标
	// 司机在没有接单的情况下上报坐标时应该设置该字段为false
    optional bool pull_peer = 5 ;

    // 根据新的需求添加dx dy表示目标位置
    optional double dx = 6;
    optional double dy = 7;
}
//CdntSvrUpRsp = RspMsg(暂不需要) //包和RspMsg一样

message PeerCoordinateInfo {
	//坐标对应的用户标识,在当前用户下唯一即可(当前为订单号)
    required string local_id = 1 ;
	// 这里需要根据司机端和乘客端转换成不同的坐标系
    required Coordinate coordinate = 2 ;
	//司机和乘客距离,单位: 米
    required uint32 distance = 3 ;
	//估计相遇时间,单位: 分钟
    required uint32 wait_time = 4 ;
	//是否已到达,true:到达 false:未到达. (agree with shichenyi)
    optional bool is_arrived_limited = 5 ;
}
enum RelationType {
	// 实时
    kRelationTypeRealTime = 0 ;
	// 预约
    kRelationTypeReservation = 1 ;
}
message PeerCoordinateRelation {
	//另一端的用户标识,在当前用户下唯一即可(当前为订单号)
    required string local_id = 1 ;
	//全局的用户id(乘客or司机)
    required uint64 user_id = 2 ;
	//不活动(推送坐标)后的超时自动删除时间
    required uint32 inactive_expire_seconds = 3 ;
	//请求端设置无效，以服务器端为准,seconds since epoch
    optional uint32 last_active_timestamp = 4 ;
	// 服务端设置，since epoch
    optional uint32 create_time = 5 ;
	// 订单类型(local_id)
    optional RelationType type = 6 ;
	//[TEMP]
    optional uint32 biz_type = 7 ;
}

//全量设置
message CdntSvrSetRelationReq {
	//我的用户id(乘客or司机)
    required uint64 user_id = 1 ;
	//会覆盖之前的
    repeated PeerCoordinateRelation relations = 2 ;
	// 推送坐标给user时的坐标系
    optional CoordinateType type = 3 ;
}
message CdntSvrSetRelationRsp {
    required RspMsg rsp_msg = 1;
	//当前关系列表
    repeated PeerCoordinateRelation relations = 2 ;
}
//增量添加
message CdntSvrAddRelationReq {
	//我的用户id(乘客or司机)
    required uint64 user_id = 1 ;
    repeated PeerCoordinateRelation relations = 2;
	// 推送坐标给user时的坐标系
    optional CoordinateType type = 3 ;
}
message CdntSvrAddRelationRsp {
    required RspMsg rsp_msg = 1;
	//当前关系列表
    repeated PeerCoordinateRelation relations = 2 ;
}
//增量添加反操作--删除
message CdntSvrDelRelationReq {
    required uint64 user_id = 1;
	//需要删除的关系的标识列表
    repeated string local_ids = 2 ;
}
message CdntSvrDelRelationRsp {
    required RspMsg rsp_msg = 1;
	//当前关系列表
    repeated PeerCoordinateRelation relations = 2 ;
}

message CdntSvrGetRelationReq {
    required uint64 user_id = 1;
}
message CdntSvrGetRelationRsp {
    required RspMsg rsp_msg = 1;
	//当前关系列表
    repeated PeerCoordinateRelation relations = 2 ;
	// 推送坐标给user时的坐标系
    optional CoordinateType type = 3 ;
}

//=====================PushSvr=============================
//PushSvr模块协议
enum PushStrategy {
    // 在请求时刻，如果目标在线，发送一次同时返回成功，否则直接返回失败
    // APP侧收到请求后不回复
    kPushStrategyNoResponse   = 0x1;

    // 在请求时刻，如果目标在线，发送一次同时返回成功，否则直接返回失败
    // APP侧收到请求后，通过kMsgTypeAppPushMessageRsp上报回包,用于运营统计
    kPushStrategyStatResponse = 0x2;

    // 在请求时刻，如果目标在线，发送一次同时返回成功，否则先暂存当前消息
    // 如果暂存成功，返回特殊错误码kRspCodePushSvrMsgStaged, 否则返回失败(其他错误码)
    // APP侧收到请求后，通过kMsgTypeAppPushMessageRsp上报回包,用于运营统计
    // 对于暂存的消息，如果在expire_seconds时间内，pushsvr会定期检查目标是否在线，如果在线则发送一次，否则暂存消息丢弃
    kPushStrategyTryBest      = 0x3;

    // 在请求时刻，如果目标在线，发送一次同时返回成功，否则先暂存当前消息
    // 如果暂存成功，返回特殊错误码kRspCodePushSvrMsgStaged, 否则返回失败(其他错误码)
    // APP侧收到请求后，通过kMsgTypeAppPushMessageRsp上报回包,用于运营统计
    // 没有收到kMsgTypeAppPushMessageRsp 则下发短信
    kPushStrategyMobileMsg    = 0x4;
};

message PushSvrReq {
	// 见下面
    optional OldRole    old_role = 1 ;
	// 如果传了user_id，优先使用user_id(role+phone_num会忽略)，否则使用role+phone_num
    optional string  phone_num = 2 ;
	// PushMsg.type为PushMessageType
    required PushMsg push_msg = 3 ;
    required PushStrategy push_strategy = 4;
	// 如果传了user_id，role+phone_num就会忽略
    optional uint64 user_id = 5 ;
	// 在push_strategy == kPushStrategyTryBest时该参数有效(必传),见PushStrategy的说明
    optional uint32 expire_seconds = 6 ;
	// PushMsg.payload的一些关键信息，用于跟踪定位问题
    optional string log_str = 7 ;
    optional int32 role = 8;
	// 短信下发内容
    optional string sms_msg = 9 ;
	// 等待rsp的超时(秒)，目前预估等待时间范围：0~180s
    optional uint32 timeout_to_sms = 10 ;
}

//message PushSvrRsp = RspMsg //包和RspMsg一样

message PushSvrMultiReq {
    message UserId {
	// 见下面
        optional OldRole    old_role = 1 ;
	// 如果传了user_id，优先使用user_id(role+phone_num会忽略)，否则使用role+phone_num
        optional string  phone_num = 2 ;
	// 如果传了user_id，role+phone_num就会忽略
        optional uint64  user_id = 3 ;
        optional int32 role = 4;
    }
    repeated UserId users = 1;
	// PushMsg.type为PushMessageType
    required PushMsg push_msg = 2 ;
    required PushStrategy push_strategy = 3;
	// 在push_strategy == kPushStrategyTryBest时该参数有效(必传),见PushStrategy的说明
    optional uint32 expire_seconds = 4 ;
	// PushMsg.payload的一些关键信息，用于跟踪定位问题
    optional string log_str = 5 ;
	// 短信下发内容
    optional string sms_msg = 6 ;
	// 等待rsp的超时(秒)，目前预估等待时间范围：0~180s
    optional uint32 timeout_to_sms = 7 ;
}

message PushSvrMultiRsp {
	//和MultiReq.users对应,按顺序返回
    repeated RspMsg rsps = 1 ;
}

	//包和BinaryMsg一样,type为PushMessageType
// message PushSvrAppRspReq = BinaryMsg ;

// PushSvrRetryReq
message PushSvrRetryReq {
    required PushSvrReq msg = 1;
    required uint64 message_id = 2;
}

	// 包和PushSvrRsp一样,type为kMsgTypePushSvrRetryRsp
// message PushSvrRetryRsp = PushSvrRsp ;

//=====================CollectSvr=============================
//CollectSvr payload消息的类型
// 参见 didi_protocol_collectsvr.proto

	// 包和BinaryMsg一样,type为CollectSvrMessageType
//message CollectSvrNoRspReq = BinaryMsg ;


message CollectSvrHeartbeatReq {} //空包，0字节的payload

message CollectSvrHeartbeatRsp {} //空包，0字节的payload

//=====================DispatchSvr=============================
// Dispatch payload消息的类型
// 这里在didi_protocol_dispatchsvr.proto里面定义

//无响应的请求
	// 包和BinaryMsg一样,type为数值，业务侧维护
//message DispatchSvrNoRspReq = BinaryMsg ;

message Param {
    required bytes key = 1;
    required bytes data = 2;
}

message DispatchSvrReq {
    required string path = 1;
    repeated Param query_params = 2;
    optional string content_type = 3;
    optional bytes post_data = 4;
}

message DispatchSvrRsp {
    required int32 sys_code = 1;
    optional int32 http_status_code = 2;
    optional bytes body = 3;
}

//=====================APP=============================
message ConnSvrConnectChallenge {
	//随机消息 (A-Za-z0-9组成的256个字节)
    required bytes random_msg = 1 ;
}
message AppHeartbeatReq {}  //空包，0字节的payload
//message AppHeartbeatRsp = RspMsg //包和RspMsg一样

	//包和BinaryMsg一样,type为PushMessageType
// message AppPushMessageReq = BinaryMsg ;
	//包和BinaryMsg一样,type为PushMessageType
// message AppPushMessageRsp = BinaryMsg ;

message CdntSvrDownReq {
    repeated PeerCoordinateInfo peer_coordinate_infos = 1;
}
//CdntSvrDownRsp = RspMsg(暂不需要) //包和RspMsg一样

//=====================RepushSvr=============================
	//包和PushSvrReq一样
// message RepushSvrStageMsgReq = PushSvrReq ;
// message RepushSvrStageMsgRsp = RspMsg //包和RspMsg一样

message PushStatReq {
    repeated uint64 task_ids = 1;
}

message PushStat {
    required uint64 task_id = 1;
    optional uint32 send_cnt = 2;
    optional uint32 recv_cnt = 3;
    optional uint32 in1s_recv_cnt = 4;
    optional uint32 in3s_recv_cnt = 5;
    optional uint32 in6s_recv_cnt = 6;
    optional uint32 in10s_recv_cnt = 7;
    optional uint32 in30s_recv_cnt = 8;
    optional uint32 in60s_recv_cnt = 9;
    optional uint32 gt60s_recv_cnt = 10;
}

message PushStatRsp {
    repeated PushStat stats = 1;
}

message StatLogReq {
    required uint32 event =  1;
    required uint64 task_id = 2;
    optional uint32 msg_type = 3;
    optional uint64 gap_us = 4;
}

enum StatEvent {
    kStatEventSend  = 0;
    kStatEventRecv  = 1;
    kStatEventView  = 2;
}

// [TEMP]/*do not use*/这里是增加业务类型，区分服务器集群
enum Business {
	// 滴滴打车
    Taxi       = 0 ;
	// 湾流
    GulfStream = 1 ;
	// 商业汽车Nova
	Nova = 2 ;
}
